<!DOCTYPE html>
<html>
<head>
    <title>Human Pose Estimation</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Human Pose Estimation</h1>
    
    <form id="upload-form">
        <input type="file" id="image-upload" accept="image/*">
        <button type="button" id="predict-button">Predict</button>
    </form>
    
    <div id="result">
        <!-- Keypoints and lines will be drawn here -->
    </div>
    
    <script>
        $(document).ready(function() {
            $("#predict-button").on("click", function() {
                var formData = new FormData();
                formData.append("image", $("#image-upload")[0].files[0]);
                
                $.ajax({
                    url: "http://max-human-pose-estimator:5000/model/predict",
                    type: "POST",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        displayPose(response);
                    },
                    error: function() {
                        alert("Error predicting keypoints.");
                    }
                });
            });
            
            function displayPose(response) {
                var resultDiv = $("#result");
                resultDiv.empty();
                
                if (response.status === "ok") {
                    var predictions = response.predictions;
                    
                    for (var i = 0; i < predictions.length; i++) {
                        var prediction = predictions[i];
                        var poseLines = prediction.pose_lines;
                        var bodyParts = prediction.body_parts;
                        
                        var canvas = document.createElement("canvas");
                        canvas.width = 640; // Set the appropriate image width
                        canvas.height = 480; // Set the appropriate image height
                        var context = canvas.getContext("2d");
                        
                        // Draw lines
                        context.strokeStyle = "#ff0000";
                        for (var j = 0; j < poseLines.length; j++) {
                            var line = poseLines[j].line;
                            context.beginPath();
                            context.moveTo(line[0], line[1]);
                            context.lineTo(line[2], line[3]);
                            context.stroke();
                        }
                        
                        // Draw keypoints
                        context.fillStyle = "#00ff00";
                        for (var k = 0; k < bodyParts.length; k++) {
                            var bodyPart = bodyParts[k];
                            context.beginPath();
                            context.arc(bodyPart.x, bodyPart.y, 5, 0, 2 * Math.PI);
                            context.fill();
                        }
                        
                        resultDiv.append(canvas);
                    }
                } else {
                    resultDiv.text("Prediction failed.");
                }
            }
        });
    </script>
</body>
</html>
